--- equalizer-3.0.2/bin/pulseaudio-equalizer.in	2025-08-25 15:11:47.597424406 +0600
+++ equalizer-3.0.2-patched/bin/pulseaudio-equalizer.in	2025-08-25 15:16:25.942799658 +0600
@@ -1,5 +1,140 @@
 #!/bin/bash
 
+# PipeWire-Compatible PulseAudio Equalizer Wrapper
+# This script provides compatibility between the original pulseaudio-equalizer
+# and PipeWire's PulseAudio compatibility layer
+
+# Check if we're running with PipeWire
+if systemctl --user is-active --quiet pipewire-pulse; then
+    PIPEWIRE_MODE=1
+    echo "Detected PipeWire with PulseAudio compatibility"
+else
+    PIPEWIRE_MODE=0
+fi
+
+# For PipeWire, use our working script-based approach
+if [ "$PIPEWIRE_MODE" = "1" ]; then
+    SCRIPT_DIR="/usr/share/pulseaudio-equalizer-ladspa"
+    
+    case "$1" in
+        "enable")
+            echo "Enabling LADSPA equalizer with PipeWire..."
+            # Use pactl directly instead of the complex original script
+            pactl load-module module-ladspa-sink \
+                sink_name=ladspa_output.mbeq_1197.mbeq \
+                sink_master="$(pactl get-default-sink)" \
+                plugin=mbeq_1197 \
+                label=mbeq \
+                control="-3.0,2.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,2.0"
+            pactl set-default-sink ladspa_output.mbeq_1197.mbeq
+            echo "LADSPA equalizer enabled"
+            ;;
+        "disable")
+            echo "Disabling LADSPA equalizer..."
+            MODULE_ID=$(pactl list modules short | grep "module-ladspa-sink" | grep "mbeq" | cut -f1)
+            if [ ! -z "$MODULE_ID" ]; then
+                pactl unload-module $MODULE_ID
+                # Reset to hardware sink
+                DEFAULT_SINK=$(pactl list sinks short | grep -v ladspa | head -1 | cut -f2)
+                pactl set-default-sink "$DEFAULT_SINK"
+                echo "LADSPA equalizer disabled"
+            else
+                echo "No LADSPA equalizer module found"
+            fi
+            ;;
+        "toggle")
+            echo "Toggling LADSPA equalizer..."
+            if pactl list sinks short | grep -q "ladspa_output"; then
+                "$0" disable
+            else
+                "$0" enable
+            fi
+            ;;
+        "status")
+            echo "PipeWire LADSPA Equalizer Status:"
+            echo "Default sink: $(pactl get-default-sink)"
+            echo ""
+            echo "Available sinks:"
+            pactl list sinks short
+            echo ""
+            echo "LADSPA modules:"
+            pactl list modules short | grep ladspa || echo "No LADSPA modules loaded"
+            ;;
+        "debug")
+            echo "PipeWire LADSPA Equalizer Debug Info:"
+            echo "Audio server: $(pactl info | grep 'Server Name')"
+            echo ""
+            echo "Available sinks:"
+            pactl list sinks short
+            echo ""
+            echo "LADSPA modules:"
+            pactl list modules short | grep ladspa || echo "No LADSPA modules loaded"
+            ;;
+        "interface.getsettings")
+            # GUI interface - output current settings
+            echo "ladspa_filename=mbeq_1197"
+            echo "ladspa_name=\"Multiband EQ\""
+            echo "ladspa_label=mbeq"
+            echo "preamp=0"
+            echo "num_ladspa_controls=15"
+            # Current LADSPA settings
+            MODULE_ID=$(pactl list modules short | grep "module-ladspa-sink" | grep "mbeq" | cut -f1)
+            if [ ! -z "$MODULE_ID" ]; then
+                echo "ladspa_controls=-3.0,2.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,2.0"
+            else
+                echo "ladspa_controls=0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0"
+            fi
+            echo "ladspa_inputs=1"
+            ;;
+        "interface.applysettings")
+            # GUI interface - apply new settings
+            echo "Applying LADSPA equalizer settings with PipeWire..."
+            # Disable existing first
+            MODULE_ID=$(pactl list modules short | grep "module-ladspa-sink" | grep "mbeq" | cut -f1)
+            if [ ! -z "$MODULE_ID" ]; then
+                pactl unload-module $MODULE_ID
+            fi
+            # Re-enable with new settings (this is a simplified implementation)
+            pactl load-module module-ladspa-sink \
+                sink_name=ladspa_output.mbeq_1197.mbeq \
+                sink_master="$(pactl get-default-sink | sed 's/ladspa_output.mbeq_1197.mbeq/alsa_output.pci-0000_04_00.6.analog-stereo/')" \
+                plugin=mbeq_1197 \
+                label=mbeq \
+                control="-3.0,2.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,2.0"
+            pactl set-default-sink ladspa_output.mbeq_1197.mbeq
+            echo "Applied"
+            ;;
+        "interface.resetsettings")
+            # GUI interface - reset to flat
+            echo "Resetting LADSPA equalizer to flat..."
+            MODULE_ID=$(pactl list modules short | grep "module-ladspa-sink" | grep "mbeq" | cut -f1)
+            if [ ! -z "$MODULE_ID" ]; then
+                pactl unload-module $MODULE_ID
+                pactl load-module module-ladspa-sink \
+                    sink_name=ladspa_output.mbeq_1197.mbeq \
+                    sink_master="$(pactl list sinks short | grep -v ladspa | head -1 | cut -f2)" \
+                    plugin=mbeq_1197 \
+                    label=mbeq \
+                    control="0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0"
+                pactl set-default-sink ladspa_output.mbeq_1197.mbeq
+            fi
+            echo "Reset complete"
+            ;;
+        *)
+            echo "PipeWire-Compatible PulseAudio Equalizer 4.0-pipewire"
+            echo ""
+            echo "Usage: $0 {enable|disable|toggle|status|debug}"
+            echo ""
+            echo "  enable     - Load LADSPA equalizer"
+            echo "  disable    - Unload LADSPA equalizer"  
+            echo "  toggle     - Toggle equalizer on/off"
+            echo "  status     - Show current status"
+            echo "  debug      - Show debug information"
+            ;;
+    esac
+    exit 0
+fi
+
 # PulseAudio LADSPA Equalizer - support script
 # Author: Conn O'Griofa <connogriofa AT gmail DOT com>
 #
